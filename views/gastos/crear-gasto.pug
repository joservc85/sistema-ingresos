//- Reemplaza el contenido de tu archivo /views/gastos/crear-gasto.pug

extends ../layout/index

block contenido
    div(class="py-10")
        h1(class="text-4xl my-10 font-extrabold text-center text-gray-800")
            | Sistema 
            span(class="font-normal") Gastos
        h2(class="text-center text-2xl font-bold text-fuchsia-600")= pagina

        div(class="mx-auto max-w-4xl")
            div(class="flex justify-start mb-4")
                a(href="/gastos" class="flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors")
                    i(class="fas fa-arrow-left")
                    span(class="font-bold") Regresar
            
            div(class="bg-white shadow-lg rounded-lg mx-auto max-w-4xl p-6 md:p-8")

                if errores
                    div(class="mb-6")
                        each error in errores
                            div(class="flex items-center bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-2" role="alert")
                                p(class="font-bold")= error.msg

                form(method="POST" action="/gastos/crear")
                    input(type="hidden" name="_csrf" value=csrfToken)

                    //- SECCIÓN DE CABECERA
                    fieldset(class="border border-gray-300 p-4 rounded-md")
                        legend(class="px-2 text-lg font-semibold text-gray-700") Datos Generales
                        div(class="grid grid-cols-1 md:grid-cols-2 gap-6")
                            div
                                label(for="proveedorId" class="block text-sm font-medium text-gray-700") Proveedor
                                select#proveedorId(name="proveedorId" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm")
                                    option(value="") -- Seleccione un Proveedor --
                                    each proveedor in proveedores
                                        option(value=proveedor.id) #{proveedor.razon_social}
                            div
                                label(for="fecha_gasto" class="block text-sm font-medium text-gray-700") Fecha del Gasto
                                input#fecha_gasto(type="date" name="fecha_gasto" value=new Date().toISOString().slice(0,10) class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm")
                            div(class="md:col-span-1")
                                label(for="numero_factura" class="block text-sm font-medium text-gray-700") Número Factura/Recibo
                                input#numero_factura(type="text" name="numero_factura" placeholder="Ej: F-001-12345" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm")
                            div(class="md:col-span-2")
                                label(for="descripcion" class="block text-sm font-medium text-gray-700") Descripción General (Opcional)
                                textarea#descripcion(name="descripcion" rows="2" placeholder="Ej: Compra de insumos para manicura" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm")

                    //- SECCIÓN DE DETALLE DEL GASTO
                    fieldset(class="mt-6 border border-gray-300 p-4 rounded-md")
                        legend(class="px-2 text-lg font-semibold text-gray-700") Detalle del Gasto
                        div(id="detalle-gastos-container" class="space-y-4")
                        button(type="button" id="agregar-detalle" class="mt-4 flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md")
                            i(class="fas fa-plus")
                            span Añadir Artículo

                    //- SECCIÓN DE TOTALES Y GUARDADO
                    div(class="mt-8 pt-5 border-t border-gray-200")
                        div(class="flex justify-end items-center gap-x-6")
                            div(class="text-right")
                                p(class="text-gray-500") Total General del Gasto:
                                p(id="total-general" class="text-3xl font-extrabold text-gray-800") $0
                            button(type="submit" class="bg-fuchsia-600 hover:bg-fuchsia-700 text-white font-bold py-3 px-8 rounded-lg shadow-md text-lg cursor-pointer") Guardar Gasto

    //- PLANTILLA PARA UNA FILA DE DETALLE (Oculta)
    template#plantilla-detalle
        div(class="detalle-item grid grid-cols-12 gap-x-3 items-end p-2 border rounded-md bg-gray-50")
            div(class="col-span-12 md:col-span-4")
                label(class="text-xs text-gray-600") Artículo / Concepto
                select(name="articuloId[]" class="articulo-buscador w-full text-sm")
            div(class="col-span-4 md:col-span-2")
                label(class="text-xs text-gray-600") Cantidad
                input(type="number" name="cantidad[]" value="1" min="0.01" step="0.01" class="w-full text-sm border-gray-300 rounded-md")
            div(class="col-span-4 md:col-span-2")
                label(class="text-xs text-gray-600") Precio Unit.
                input(type="text" placeholder="0" class="w-full text-sm border-gray-300 rounded-md px-2 text-right precio-visible")
                input(type="hidden" name="precio_unitario[]" class="precio-oculto" value="0")
            div(class="col-span-4 md:col-span-3 text-center md:text-right")
                label(class="text-xs text-gray-600") Subtotal
                p(class="detalle-subtotal font-bold text-gray-800") $0
            div(class="col-span-12 md:col-span-1 flex justify-end md:justify-center items-end pb-1")
                button(type="button" class="eliminar-detalle text-red-500 hover:text-red-700 p-2")
                    i(class="fas fa-trash-alt")

block scripts
    //- --- ¡NUEVO! Estilos para corregir el bug visual de TomSelect ---
    style.
        .ts-wrapper.single .ts-control, .ts-wrapper.single .ts-control input {
        cursor: text;
        }
        .ts-wrapper .ts-control > div {
            color: #1f2937; /* text-gray-800 */
        }
    script(src="/js/formGasto.js")
