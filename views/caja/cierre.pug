extends ../layout/index

block contenido
    div(class="py-10")
        h1(class="text-3xl md:text-4xl my-10 font-extrabold text-center") Cierre de 
            span(class="font-normal") Caja
        h2(class="text-center text-2xl font-bold text-fuchsia-600")= pagina

        div(class="mt-8 mx-auto max-w-4xl px-4")
            //- Formulario para seleccionar la fecha
            if usuario && usuario.role && usuario.role.nombre === 'Admin'
                form(method="GET" action="/cierre-caja" class="bg-white p-4 rounded-lg shadow-md mb-8 flex flex-col sm:flex-row items-end gap-4")
                    div(class="flex-grow w-full")
                        label(for="fecha" class="block text-sm font-medium text-gray-700 mb-1") Seleccionar Fecha del Cierre
                        input(type="date" name="fecha" value=fechaSeleccionada class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-fuchsia-500 focus:border-fuchsia-500")
                    button(type="submit" class="w-full sm:w-auto flex-shrink-0 bg-fuchsia-600 text-white px-6 py-2 rounded-md font-bold hover:bg-fuchsia-700 transition") Consultar

            //- Formulario principal para el cierre
            form(method="POST" action="/cierre-caja/guardar")
                input(type="hidden" name="_csrf" value=csrfToken)
                input(type="hidden" name="fecha_cierre" value=fechaSeleccionada)
                input#total_efectivo_sistema(type="hidden" name="total_efectivo_sistema" value=totalEfectivo)
                input(type="hidden" name="total_datafono" value=totalDatafono)
                input(type="hidden" name="total_transferencia" value=totalTransferencia)
                input(type="hidden" name="total_vales" value=totalVales)
                input(type="hidden" name="total_ventas_dia" value=totalVentasDia)
                input#desglose_efectivo_hidden(type="hidden" name="desglose_efectivo")

                //- Tarjeta con el resumen del sistema
                div(class="bg-white p-6 md:p-8 rounded-lg shadow-lg border-t-4 border-gray-300 mb-8")
                    h3(class="text-xl font-bold text-gray-800 border-b pb-3 mb-4") Resumen del Sistema
                    div(class="space-y-3 text-lg")
                        div(class="flex justify-between items-center")
                            span(class="text-gray-600") Total en Efectivo (Sistema):
                            span(class="font-semibold text-green-600") $#{totalEfectivo.toLocaleString('es-CO')}
                        div(class="flex justify-between items-center")
                            span(class="text-gray-600") Total en Datafono:
                            span(class="font-semibold text-green-600") $#{totalDatafono.toLocaleString('es-CO')}
                        div(class="flex justify-between items-center")
                            span(class="text-gray-600") Total en Transferencia:
                            span(class="font-semibold text-green-600") $#{totalTransferencia.toLocaleString('es-CO')}
                        div(class="flex justify-between items-center border-t pt-3 mt-3")
                            span(class="font-bold text-gray-800") Total Ventas del Día:
                            span(class="font-bold text-xl text-gray-900") $#{totalVentasDia.toLocaleString('es-CO')}
                        div(class="flex justify-between items-center mt-4")
                            span(class="text-gray-600") Total en Vales (Egresos):
                            span(class="font-semibold text-red-600") -$#{totalVales.toLocaleString('es-CO')}

                //- Tarjeta para el conteo de efectivo
                div(class="bg-white p-6 md:p-8 rounded-lg shadow-lg border-t-4 border-blue-500")
                    h3(class="text-xl font-bold text-gray-800 border-b pb-3 mb-4") Conteo de Efectivo
                    div(class="grid grid-cols-2 md:grid-cols-4 gap-4")
                        //- Billetes
                        each val in [100000, 50000, 20000, 10000, 5000, 2000, 1000]
                            div
                                label(class="block text-sm font-medium text-gray-700") Billetes de #{val.toLocaleString('es-CO')}
                                input(type="number" data-valor=val class="conteo-efectivo mt-1 block w-full rounded-md border-gray-300 shadow-sm" min="0")
                        //- Monedas
                        div
                            label(class="block text-sm font-medium text-gray-700") Monedas
                            input(type="number" data-valor="1" class="conteo-efectivo mt-1 block w-full rounded-md border-gray-300 shadow-sm" min="0" step="any")
                    
                    //- Resultados del conteo
                    div(class="mt-6 pt-4 border-t space-y-3 text-lg")
                        div(class="flex justify-between items-center")
                            span(class="text-gray-600") Total Efectivo Contado:
                            input#total_efectivo_contado(type="hidden" name="total_efectivo_contado")
                            span#total_efectivo_display(class="font-semibold text-blue-600") $0
                        div(class="flex justify-between items-center")
                            span(class="text-gray-600") Descuadre (Diferencia):
                            input#descuadre_hidden(type="hidden" name="descuadre")
                            span#descuadre_display(class="font-bold text-xl text-red-600") $0
                    
                    //- Observaciones
                    div(class="mt-6")
                        label(for="observaciones" class="block text-sm font-medium text-gray-700") Observaciones
                        textarea(name="observaciones" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm")
                
                //- Botón para guardar
                div(class="mt-8 pt-6 border-t flex justify-end")
                    button(type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-md cursor-pointer") Confirmar y Guardar Cierre
                
block scripts
    script(src="/js/cierreCaja.js")