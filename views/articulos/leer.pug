extends ../layout/index

block contenido
    // Contenedor principal para el panel
    div(class="py-10 max-w-7xl mx-auto")
        
        // Título de la página
        h1(class="text-4xl my-10 font-extrabold text-center text-gray-800")
            | Sistema 
            span(class="font-normal") Gastos
        h2(class="text-center text-2xl font-bold text-fuchsia-600")= pagina

        form(method="GET" action="/articulos/leer" class="bg-white border border-gray-200 p-4 rounded-lg shadow-sm mb-8")
            div(class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end")
                //- Buscador por Nombre
                div(class="md:col-span-1")
                    label(for="busqueda" class="block text-sm font-medium text-gray-700 mb-1") Buscar por Nombre
                    input(type="text" name="busqueda" id="busqueda" placeholder="Escribe aquí..." value=query.busqueda || '' class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500")
                
                //- Filtro por Categoría
                div(class="md:col-span-1")
                    label(for="categoriaId" class="block text-sm font-medium text-gray-700 mb-1") Filtrar por Categoría
                    select(name="categoriaId" id="categoriaId" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500")
                        option(value="") -- Todas --
                        each categoria in categorias
                            option(value=categoria.id selected=(query.categoriaId == categoria.id))= categoria.nombre_categoria

                //- Botones de Acción
                div(class="flex items-center gap-2 w-full md:w-auto")
                    button(type="submit" class="w-full md:w-auto flex items-center justify-center gap-2 bg-fuchsia-600 hover:bg-fuchsia-700 text-white font-bold px-4 py-2 rounded-lg transition")
                        i(class="fas fa-search")
                        span Filtrar
                    a(href="/articulos/leer" class="w-full md:w-auto flex items-center justify-center gap-2 bg-gray-400 hover:bg-gray-500 text-white font-bold px-4 py-2 rounded-lg transition")
                        i(class="fas fa-undo")
                        span Limpiar
       
        // Mensaje para cuando no hay artículos registrados
        if !articulos || !articulos.length
            div(class="text-center py-10 mt-8 bg-white shadow-lg rounded-lg")
                p(class="text-xl text-gray-600") No hay artículos o conceptos registrados todavía.
                a(href="/articulos/crear" class="mt-4 inline-block bg-fuchsia-500 hover:bg-fuchsia-600 text-white font-bold py-2 px-4 rounded-md transition-colors") ¡Registra el primero!
        else
            // Contenedor de la tabla con sombra y bordes redondeados
            div(class="mt-8 bg-slate-50 border border-slate-200 p-4 rounded-lg shadow-sm mb-8")
                div(class="flex justify-start mb-6")
                    a(href="/articulos/crear" class="flex items-center gap-2 bg-gradient-to-r from-fuchsia-500 to-purple-600 hover:from-fuchsia-600 hover:to-purple-700 text-white font-bold py-2 px-4 rounded-md transition-all")
                        i(class="fas fa-plus")
                        span Nuevo Articulo
                    
                    //- Se agregó ml-4 para añadir un margen a la izquierda
                    a(href="/inventario" class="flex items-center gap-2 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-md transition-all ml-4")
                        i(class="fas fa-boxes-stacked")
                        span Ver Inventario
                
                table(class="min-w-full leading-normal")
                    // Encabezado de la tabla
                    thead
                        tr
                            th(class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider") Nombre
                            th(class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider") Categoría
                            th(class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider") Cantidades
                            th(class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider") Estado
                            th(class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider") Acciones

                    // Cuerpo de la tabla
                    tbody
                        // Hacemos un bucle sobre la variable 'articulos'
                        each articulo in articulos
                            tr
                                td(class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-center")
                                    p(class="text-gray-900 whitespace-no-wrap font-semibold")= articulo.nombre_articulo
                                
                                td(class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-center")
                                    p(class="text-gray-900 whitespace-no-wrap")= articulo.categoria ? articulo.categoria.nombre_categoria : 'N/A'
                                
                                td(class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-center")
                                    //- Condición: Si el stock actual es menor o igual al stock mínimo
                                    if articulo.stock_actual <= articulo.stock_minimo
                                        //- Contenedor para el mensaje de "Agotándose"
                                        div(class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded-full")
                                            i(class="fas fa-exclamation-triangle mr-1")
                                            span= `${articulo.stock_actual || 0} ${articulo.unidad ? articulo.unidad.abreviatura : 'N/A'} - Agotándose`
                                    else
                                        //- Muestra normal si el stock es suficiente
                                        p(class="text-gray-900 whitespace-no-wrap")= `${articulo.stock_actual || 0} ${articulo.unidad ? articulo.unidad.abreviatura : 'N/A'}`
                                                                                                
                                td(class="px-5 py-5 border-b border-gray-200 bg-white text-sm text-center")
                                    span(class=`px-3 py-1 text-xs font-semibold rounded-full ${articulo.activo ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}`)= articulo.activo ? 'Activo' : 'Inactivo'

                                // Celda de acciones con botones estilizados y centrados
                                td(class="px-5 py-5 border-b border-gray-200 bg-white text-sm")
                                    if usuario && usuario.role && usuario.role.nombre === 'Admin'
                                        div(class="flex items-center justify-center gap-x-4")
                                            // Botón Editar estilizado
                                            a(href=`/articulos/editar/${articulo.id}` class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-1 rounded-md font-semibold text-xs transition-colors") Editar
                                            
                                            // Formulario de Eliminar con botón estilizado
                                            form(method="POST" action=`/articulos/eliminar/${articulo.id}` class="inline form-eliminar")
                                                input(type="hidden" name="_csrf" value=csrfToken)
                                                // Botón Eliminar estilizado
                                                button(type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-1 rounded-md font-semibold text-xs transition-colors cursor-pointer") Eliminar
                                    else 
                                        div(class="flex items-center justify-center gap-x-4")
                                            a(href="#" class="bg-gray-400 text-white px-3 py-1 rounded-md font-semibold text-xs transition-colors pointer-events-none cursor-not-allowed" title="No tienes permiso para editar") Editar

                                            form(method="POST" action="#")
                                                input(type="hidden" name="_csrf" value=csrfToken)
                                                button(type="submit" class="bg-gray-400 text-white px-3 py-1 rounded-md font-semibold text-xs transition-colors cursor-not-allowed" title="No tienes permiso para eliminar" disabled) Eliminar
            
            //- Paginación (si existe)
            if totalPaginas > 1
                div(class="mt-8")
                    include ../layout/paginacion

block scripts
    //- Asegúrate de que el script JS siga siendo compatible o ajústalo si es necesario
    script(src="/js/articulos.js")